---
title: "業務で Svelte を使ってみた (Reactから方針転換)"
emoji: "📕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Svelte", "Sveltekit", "React"]
published: false
---

普段の業務では React しか使っていなかったのですが、途中まで React で書いていたものを Svelte に変えて進めるプロジェクトがありました。知見をまとめてみます。

3 行まとめ

- 不足部分を自力で書く覚悟がいるが、今は AI で書ける
- 入力欄が多いなら恩恵が大きい
- 結局トレードオフで、どちらにせよ銀の弾丸ではない

## 背景情報

- toB の管理者画面中心な web アプリ
- テーブルで入力するページがすごくたくさんある
- ご存じの通り、大量の入力欄があるページを React で愚直に実装すると異常に重くなる
- 既存デスクトップアプリの web 化対応のため、仕様側を変えることは難しかった
- web ほぼ未経験のメンバーの救援として入ったプロジェクトで、完全リリースせず私は関わらなくなる

React でテーブルがネックになることは分かっていたので、小さく検証
→ もちろんメモ化すれば大丈夫
→ かなり複雑化したコードを引き継げるか？

Svelte でも合わせて検証
→ 実装すっきり
→ テーブルだらけの本 PJ で React は適切ではないのでは？

検証が整った段階で React と Svelte のソースコードを両方提示し、マネージャーを巻き込んでメリットとデメリットを説明。
結果、React をやめて Svelte に置き換えることになりました。

:::message
React Compiler も候補にありましたが、変な挙動が起きたとき、メモ化が働かなかったときの調査や対応をメンバーだけで行うのは難しいと判断し、選択肢に入れませんでした。
（投稿現在 React Compiler は v1 になったようですが、当時は v0 でした）
:::

## 悪かったところ

### ライブラリが貧弱、あるいはバグで使用中止

信頼できるライブラリが Tanstack 系ぐらいしかありませんでした。
逆に言えば Tanstack には救われました。ありがとう Tanstack !!!

---

UI 系は tailwind を避けるとほとんど選択肢がなく、始めは Ark UI を使っていましたが致命的なバグに遭遇し、極力使用をやめる方向で進めました。

特に

> テーブルが編集可能に切り替わり Select がレンダリングされると、
> 直接関係ないはずの Pagination のリアクティビティが壊れる
> （1 レンダリング分遅れる）

という摩訶不思議な現象には苦しめられました。
Ark UI やめて自前実装したら直りました……。Svelte5 が悪いかもしれないけど……

---

また Svelte 本体側のバグのような現象にも遭遇しており、

> typescript 上では undefined なし、
> かつ {#if ...} シンタックスで undefined チェックまでしているにも関わらず、
> 初回レンダリングの最初の一瞬だけ undefined になってしまい例外が出て壊れる

という現象も、sveltekit の load 周りで起きていました。これは原因不明。

### まだ svelte5 への過渡期

Tanstack Query の記法が svelte4 以前向けだったりして影響を受けました。

開発途中で tanstack query は Svelte5 対応したのですが、orval との兼ね合いで上げられなかったり…。

## 良かったところ

### 書きやすい

React 特有の事情を考慮に入れる必要がなく、ほぼ html と css に向き合うだけのコンポーネント実装は本当に楽でした。

### AI 生成の品質が良い

React だと平気で useEffect を乱用したり酷い品質のコードを AI くんが生成しやがりますが、Svelte ではあまり見ないので快適でしたという話です。

css にも影響があって、「いい感じで」とか「モダンで」みたいな曖昧な指定をすると Svelte の方がおしゃれな UI を出力してくれる傾向が強いです。

この「品質の低いコードを AI が学習してしまっている」問題、どうにかできるんでしょうか。これでばらまかれたコードを再学習されたらどんどん悪化していくのでは……？

### パフォーマンスの大幅向上

特に最適化は意識していませんでしたが、Svelte にしただけで重い箇所はほぼなくなりました。

特に、配列のレンダリングでも軽いのが素晴らしい。

### 不足部分は AI 生成でなんとかなる

途中からコンポーネントライブラリやめて自作していましたが、web 標準から逸脱しない機能は AI 任せの一瞬で作れていました。

最近は shadcn/ui の影響もあり、自作してプロジェクト内に置いておくことに抵抗感がなくなっているのも追い風ですね。

しかしアクセシビリティを難しいので、React Aria に頼れなくなった箇所は一部厄介でした。ツールチップなど。

### web 標準、ライブラリ非依存 npm パッケージへの意識向上

React だと大抵のものは既に npm にありますよね。車輪の再発明を避けたい心理から react-xxx ってパッケージを安易に入れてしまい、それが動作・ビルドを重くしたり、web 標準から逸脱した実装になりがちな側面があると思います。

svelte 向けのパッケージはほとんどない、あるいはメンテナンス放棄されているものだらけの荒地ですので、「作らなければならない」という覚悟を持って向き合うことになります。

10 年前からある weekly download 100 万超の伝説級パッケージを、現代の html と組み合わせて使うことになり、React 環境に依存しない実装力が自然と上がった感覚がありました。

## 総評

パフォーマンス面は明確に恩恵がありました。

Svelte に変えたことで発生した苦労はありましたが、React テーブルのメモ化に苦しむコストでトントンという感じがします。やはり銀の弾丸はありませんね。

普段の開発は React 安定ではありますが、入力欄がたくさんあるページが大半を占めるなら今後も Svelte を選択肢に入れていきたいと思います。

### React を Svelte に置き換える価値はありましたか？

置き換えなかったパラレルワールドの自分に聞かないとわかりません！！

「大きな価値があった」と胸を張って言える自信はないのですが、「変わらない、あるいは少し良くなった」実感はあり、マイナスでなかったことは間違いないと思っています。
